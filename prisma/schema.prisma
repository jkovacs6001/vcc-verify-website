generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("PRISMA_DATABASE_URL")
}

enum ReviewStatus {
  PENDING
  REVIEWING
  READY_FOR_APPROVAL
  APPROVED
  REJECTED
}

enum UserRole {
  MEMBER
  REVIEWER
  APPROVER
  ADMIN
}

model Profile {
  id           String       @id @default(cuid())
  displayName  String
  handle       String?
  submissionRole String?      // The role they're applying for (Dev, Designer, etc) - null if no application
  location     String?
  bio          String?
  skills       String[]     @default([])
  tags         String[]     @default([])

  // Identity / contact
  email        String       @unique
  passwordHash String       // Hashed password for authentication
  telegram     String?
  xHandle      String?
  website      String?
  github       String?
  linkedin     String?

  // Web3
  chain        String?      @default("solana")
  wallet       String?

  // Permissions
  userRole     UserRole     @default(MEMBER)

  // Verification application status - null means account-only (no verification application)
  status       ReviewStatus?
  reviewedAt   DateTime?
  reviewerNote String?

  references   Reference[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@index([status])
  @@index([wallet])
  @@index([userRole])
}

model Reference {
  id          String   @id @default(cuid())
  profileId   String
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  name        String
  relationship String?
  contact     String? // email/telegram/etc
  link        String? // project link, tweet, github, etc
  notes       String?

  createdAt   DateTime @default(now())
}
